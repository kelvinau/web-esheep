"use strict";var _createClass=function(){function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var VERSION="0.7.1",ACTIVATE_DEBUG=!1,DEFAULT_XML="http://esheep.petrucci.ch/script/animation.php",COLLISION_WITH=["div","hr"],eSheep=function(){function eSheep(e){_classCallCheck(this,eSheep),this.animationFile=DEFAULT_XML,this.id=Date.now()+Math.random(),this.DOMdiv=document.createElement("div"),this.DOMdiv.setAttribute("id",this.id),this.DOMimg=document.createElement("img"),this.DOMinfo=document.createElement("div"),this.parser=new DOMParser,this.xmlDoc=null,this.isChild=null!=e,this.tilesX=1,this.tilesY=1,this.imageW=1,this.imageH=1,this.imageX=1,this.imageY=1,this.flipped=!1,this.dragging=!1,this.infobox=!1,this.animationId=0,this.animationStep=0,this.animationNode=null,this.sprite=new Image,this.HTMLelement=null,this.randS=100*Math.random(),this.screenW=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,this.screenH=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}return _createClass(eSheep,[{key:"Start",value:function(e){void 0!==e&&null!=e&&(this.animationFile=e);var t=new XMLHttpRequest,i=this;t.open("GET",this.animationFile,!0),t.addEventListener("readystatechange",function(){4==this.readyState&&(200==this.status?i._parseXML(this.responseText):console.error("XML not available:"+this.statusText+"\n"+this.responseText))}),t.send(null)}},{key:"remove",value:function(){this.DOMdiv=this.DOMimg=this.DOMinfo=null,document.getElementById(this.id).outerHTML=""}},{key:"_parseXML",value:function(e){var a=this;this.xmlDoc=this.parser.parseFromString(e,"text/xml");var t=this.xmlDoc.getElementsByTagName("image")[0];this.tilesX=t.getElementsByTagName("tilesx")[0].textContent,this.tilesY=t.getElementsByTagName("tilesy")[0].textContent,this.sprite.addEventListener("load",function(){ACTIVATE_DEBUG&&console.log("Sprite image loaded");var e="width:"+a.sprite.width+"px;height:"+a.sprite.height+"px;position:absolute;top:0px;left:0px;max-width: none;";a.DOMimg.setAttribute("style",e),a.DOMimg.addEventListener("dragstart",function(e){return e.preventDefault(),!1}),a.imageW=a.sprite.width/a.tilesX,a.imageH=a.sprite.height/a.tilesY,e="width:"+a.imageW+"px;height:"+a.imageH+"px;position:fixed;top:"+a.imageY+"px;left:"+a.imageX+"px;transform:rotatey(0deg);cursor:move;z-index:2000;overflow:hidden;",a.DOMdiv.setAttribute("style",e),a.DOMdiv.appendChild(a.DOMimg),a.isChild?a._spawnChild():a._spawnESheep()}),this.sprite.src="data:image/png;base64,"+t.getElementsByTagName("png")[0].textContent,this.DOMimg.setAttribute("src",this.sprite.src),this.DOMdiv.addEventListener("mousemove",function(e){if(!a.dragging&&1==e.buttons&&0==e.button){a.dragging=!0,a.HTMLelement=null;for(var t=a.xmlDoc.getElementsByTagName("animations")[0].getElementsByTagName("animation"),i=0;i<t.length;i++)if("drag"==t[i].getElementsByTagName("name")[0].textContent){a.animationId=t[i].getAttribute("id"),a.animationStep=0,a.animationNode=t[i];break}}}),document.body.addEventListener("mousemove",function(e){a.dragging&&(a.imageX=parseInt(e.clientX)-a.imageW/2,a.imageY=parseInt(e.clientY)-a.imageH/2,a.DOMdiv.style.left=a.imageX+"px",a.DOMdiv.style.top=a.imageY+"px")}),document.body.addEventListener("resize",function(){a.screenW=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a.screenH=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,a.imageY+a.imageH>a.screenH&&(a.imageY=a.screenH-a.imageH,a.DOMdiv.style.top=a.imageY+"px"),a.imageX+a.imageW>a.screenW&&(a.imageX=a.screenW-a.imageW,a.DOMdiv.style.left=a.imageX+"px")}),this.DOMdiv.addEventListener("contextmenu",function(e){return e.preventDefault(),!1}),this.DOMdiv.addEventListener("mouseup",function(){a.dragging&&(a.dragging=!1)}),document.body.appendChild(this.DOMdiv)}},{key:"_setPosition",value:function(e,t,i){this.DOMdiv&&(i?(this.imageX=parseInt(e),this.imageY=parseInt(t)):(this.imageX=parseInt(this.imageX)+parseInt(e),this.imageY=parseInt(this.imageY)+parseInt(t)),this.DOMdiv.style.left=this.imageX+"px",this.DOMdiv.style.top=this.imageY+"px")}},{key:"_spawnESheep",value:function(){for(var e=this.xmlDoc.getElementsByTagName("spawns")[0].getElementsByTagName("spawn"),t=0,i=0;i<e.length;i++)t+=parseInt(e[0].getAttribute("probability"));var a=Math.random()*t;for(i=t=0;i<e.length;i++)if(a<=(t+=parseInt(e[i].getAttribute("probability")))||i==e.length-1){this._setPosition(this._parseKeyWords(e[i].getElementsByTagName("x")[0].textContent),this._parseKeyWords(e[i].getElementsByTagName("y")[0].textContent),!0),ACTIVATE_DEBUG&&console.log("Spawn: "+this.imageX+", "+this.imageY),this.animationId=e[i].getElementsByTagName("next")[0].textContent,this.animationStep=0;for(var n=this.xmlDoc.getElementsByTagName("animations")[0].getElementsByTagName("animation"),s=0;s<n.length;s++)if(n[s].getAttribute("id")==this.animationId){this.animationNode=n[s];n=this.xmlDoc.getElementsByTagName("childs")[0].getElementsByTagName("child");for(var m=0;m<n.length;m++)if(n[m].getAttribute("animationid")==this.animationId){ACTIVATE_DEBUG&&console.log("Child from Spawn");var o=new eSheep(!0);o.animationId=n[m].getElementsByTagName("next")[0].textContent;var h=n[m].getElementsByTagName("x")[0].textContent,r=n[m].getElementsByTagName("y")[0].textContent;o._setPosition(this._parseKeyWords(h),this._parseKeyWords(r),!0),o.Start(this.animationFile);break}break}break}this._nextESheepStep()}},{key:"_spawnChild",value:function(){for(var e=this.xmlDoc.getElementsByTagName("animations")[0].getElementsByTagName("animation"),t=0;t<e.length;t++)if(e[t].getAttribute("id")==this.animationId){this.animationNode=e[t];break}this._nextESheepStep()}},{key:"_parseKeyWords",value:function _parseKeyWords(value){value=value.replace(/screenW/g,this.screenW),value=value.replace(/screenH/g,this.screenH),value=value.replace(/areaW/g,this.screenH),value=value.replace(/areaH/g,this.screenH),value=value.replace(/imageW/g,this.imageW),value=value.replace(/imageH/g,this.imageH),value=value.replace(/random/g,100*Math.random()),value=value.replace(/randS/g,this.randS),value=value.replace(/imageX/g,this.imageX),value=value.replace(/imageY/g,this.imageY);var ret=0;try{ret=eval(value)}catch(e){console.error("Unable to parse this position: \n'"+value+"'\n Error message: \n"+e.message)}return ret}},{key:"_getNextRandomNode",value:function(e){var t=e.getElementsByTagName("next"),i=this.xmlDoc.getElementsByTagName("animations")[0].getElementsByTagName("animation"),a=0,n=!1;if(0==t.length)return this.isChild?(ACTIVATE_DEBUG&&console.log("Remove child"),document.body.removeChild(this.DOMinfo),document.body.removeChild(this.DOMdiv)):this._spawnESheep(),!1;for(var s=0;s<t.length;s++)a+=parseInt(t[s].getAttribute("probability"));var m=Math.random()*a,o=0;for(s=a=0;s<t.length;s++)if(m<=(a+=parseInt(t[s].getAttribute("probability")))){o=s;break}for(s=0;s<i.length;s++)if(i[s].getAttribute("id")==t[o].textContent){this.animationId=i[s].getAttribute("id"),this.animationStep=0,this.animationNode=i[s],n=!0;break}if(n){i=this.xmlDoc.getElementsByTagName("childs")[0].getElementsByTagName("child");for(s=0;s<i.length;s++)if(i[s].getAttribute("animationid")==this.animationId){ACTIVATE_DEBUG&&console.log("Child from Animation");var h=new eSheep(!0);h.animationId=i[s].getElementsByTagName("next")[0].textContent;var r=i[s].getElementsByTagName("x")[0].textContent,g=i[s].getElementsByTagName("y")[0].textContent;h._setPosition(this._parseKeyWords(r),this._parseKeyWords(g),!0),h.Start(this.animationFile);break}}return n}},{key:"_checkOverlapping",value:function(){var e,t=this.imageX,i=this.imageY+this.imageH,a=20;for(var n in this.HTMLelement&&(a=5),COLLISION_WITH)for(var s=document.body.getElementsByTagName(COLLISION_WITH[n]),m=0;m<s.length;m++)if(i>(e=s[m].getBoundingClientRect()).top-2&&i<e.top+a&&t>e.left&&t<e.right-this.imageW){var o=window.getComputedStyle(s[m]);if(""!=o.borderTopStyle&&"none"!=o.borderTopStyle&&"none"!=o.display)return s[m]}return!1}},{key:"_getNodeValue",value:function(e,t,i){if(this.animationNode&&this.animationNode.getElementsByTagName(e)){if(this.animationNode.getElementsByTagName(e)[0].getElementsByTagName(t)[0]){var a=this.animationNode.getElementsByTagName(e)[0].getElementsByTagName(t)[0].textContent;return this._parseKeyWords(a)}return i}}},{key:"_nextESheepStep",value:function(){var e,t=this._getNodeValue("start","x",0),i=this._getNodeValue("start","y",0),a=(this._getNodeValue("start","offsety",0),this._getNodeValue("start","opacity",1),this._getNodeValue("start","interval",1e3)),n=this._getNodeValue("end","x",0),s=this._getNodeValue("end","y",0),m=(this._getNodeValue("end","offsety",0),this._getNodeValue("end","interval",1),this._getNodeValue("end","interval",1e3)),o=this._parseKeyWords(this.animationNode.getElementsByTagName("sequence")[0].getAttribute("repeat")),h=this.animationNode.getElementsByTagName("sequence")[0].getAttribute("repeatfrom"),r=this.animationNode.getElementsByTagName("gravity"),g=this.animationNode.getElementsByTagName("border"),l=this.animationNode.getElementsByTagName("frame").length+(this.animationNode.getElementsByTagName("frame").length-h)*o;if(e=this.animationStep<this.animationNode.getElementsByTagName("frame").length?this.animationNode.getElementsByTagName("frame")[this.animationStep].textContent:0==h?this.animationNode.getElementsByTagName("frame")[this.animationStep%this.animationNode.getElementsByTagName("frame").length].textContent:this.animationNode.getElementsByTagName("frame")[parseInt(h)+parseInt((this.animationStep-h)%(this.animationNode.getElementsByTagName("frame").length-h))].textContent,this.DOMimg.style.left=-this.imageW*(e%this.tilesX)+"px",this.DOMimg.style.top=-this.imageH*parseInt(e/this.tilesX)+"px",this.dragging||this.infobox)return this.animationStep++,void setTimeout(this._nextESheepStep.bind(this),50);if(this.flipped&&(t=-t,n=-n),0==this.animationStep?this._setPosition(t,i,!1):this._setPosition(parseInt(t)+parseInt((n-t)*this.animationStep/l),parseInt(i)+parseInt((s-i)*this.animationStep/l),!1),this.animationStep++,this.animationStep>=l){if(this.animationNode.getElementsByTagName("action")[0])switch(this.animationNode.getElementsByTagName("action")[0].textContent){case"flip":"rotateY(0deg)"==this.DOMdiv.style.transform?(this.DOMdiv.style.transform="rotateY(180deg)",this.flipped=!0):(this.DOMdiv.style.transform="rotateY(0deg)",this.flipped=!1)}if(!this._getNextRandomNode(this.animationNode.getElementsByTagName("sequence")[0]))return}var d=!1;return g&&g[0]&&g[0].getElementsByTagName("next")&&(n<0&&this.imageX<0?d=!(this.imageX=0):0<n&&this.imageX>this.screenW-this.imageW?(this.imageX=this.screenW-this.imageW,this.DOMdiv.style.left=parseInt(this.imageX)+"px",d=!0):s<0&&this.imageY<0?d=!(this.imageY=0):0<s&&this.imageY>this.screenH-this.imageH?(this.imageY=this.screenH-this.imageH,d=!0):0<s?this._checkOverlapping()&&this.imageY>this.imageH&&(this.HTMLelement=this._checkOverlapping(),this.imageY=Math.ceil(this.HTMLelement.getBoundingClientRect().top)-this.imageH,d=!0):this.HTMLelement&&(this._checkOverlapping()||(this.imageY+this.imageH>this.HTMLelement.getBoundingClientRect().top+3||this.imageY+this.imageH<this.HTMLelement.getBoundingClientRect().top-3?this.HTMLelement=null:(this.imageX<this.HTMLelement.getBoundingClientRect().left?this.imageX=parseInt(this.imageX+3):this.imageX=parseInt(this.imageX-3),d=!0),this.DOMdiv.style.left=parseInt(this.imageX)+"px")),d&&!this._getNextRandomNode(g[0]))||!d&&r&&r[0]&&r[0].getElementsByTagName("next")&&this.imageY<this.screenH-this.imageH-2&&(null==this.HTMLelement?d=!0:this._checkOverlapping()||(d=!0,this.HTMLelement=null),d&&!this._getNextRandomNode(r[0]))?void 0:!d&&(this.imageX<-this.imageW&&n<0||this.imageX>this.screenW&&0<n||this.imageY<-this.imageH&&i<0||this.imageY>this.screenH&&0<s)?(d=!0,void(this.isChild||this._spawnESheep())):void setTimeout(this._nextESheepStep.bind(this),parseInt(a)+parseInt((m-a)*this.animationStep/l))}}]),eSheep}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVzaGVlcC5taW4uanMiXSwibmFtZXMiOlsiX2NyZWF0ZUNsYXNzIiwiZGVmaW5lUHJvcGVydGllcyIsInRhcmdldCIsInByb3BzIiwiaSIsImxlbmd0aCIsImRlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImtleSIsIkNvbnN0cnVjdG9yIiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJUeXBlRXJyb3IiLCJWRVJTSU9OIiwiQUNUSVZBVEVfREVCVUciLCJERUZBVUxUX1hNTCIsIkNPTExJU0lPTl9XSVRIIiwiZVNoZWVwIiwiaXNDaGlsZCIsInRoaXMiLCJhbmltYXRpb25GaWxlIiwiaWQiLCJEYXRlIiwibm93IiwiTWF0aCIsInJhbmRvbSIsIkRPTWRpdiIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsIkRPTWltZyIsIkRPTWluZm8iLCJwYXJzZXIiLCJET01QYXJzZXIiLCJ4bWxEb2MiLCJ0aWxlc1giLCJ0aWxlc1kiLCJpbWFnZVciLCJpbWFnZUgiLCJpbWFnZVgiLCJpbWFnZVkiLCJmbGlwcGVkIiwiZHJhZ2dpbmciLCJpbmZvYm94IiwiYW5pbWF0aW9uSWQiLCJhbmltYXRpb25TdGVwIiwiYW5pbWF0aW9uTm9kZSIsInNwcml0ZSIsIkltYWdlIiwiSFRNTGVsZW1lbnQiLCJyYW5kUyIsInNjcmVlblciLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwiZG9jdW1lbnRFbGVtZW50IiwiY2xpZW50V2lkdGgiLCJib2R5Iiwic2NyZWVuSCIsImlubmVySGVpZ2h0IiwiY2xpZW50SGVpZ2h0IiwidmFsdWUiLCJhbmltYXRpb24iLCJhamF4IiwiWE1MSHR0cFJlcXVlc3QiLCJzaGVlcENsYXNzIiwib3BlbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwiX3BhcnNlWE1MIiwicmVzcG9uc2VUZXh0IiwiY29uc29sZSIsImVycm9yIiwic3RhdHVzVGV4dCIsInNlbmQiLCJnZXRFbGVtZW50QnlJZCIsIm91dGVySFRNTCIsInRleHQiLCJfdGhpcyIsInBhcnNlRnJvbVN0cmluZyIsImltYWdlIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJ0ZXh0Q29udGVudCIsImxvZyIsImF0dHJpYnV0ZSIsIndpZHRoIiwiaGVpZ2h0IiwiZSIsInByZXZlbnREZWZhdWx0IiwiYXBwZW5kQ2hpbGQiLCJfc3Bhd25DaGlsZCIsIl9zcGF3bkVTaGVlcCIsInNyYyIsImJ1dHRvbnMiLCJidXR0b24iLCJjaGlsZHMiLCJrIiwiZ2V0QXR0cmlidXRlIiwicGFyc2VJbnQiLCJjbGllbnRYIiwiY2xpZW50WSIsInN0eWxlIiwibGVmdCIsInRvcCIsIngiLCJ5IiwiYWJzb2x1dGUiLCJzcGF3bnMiLCJwcm9iIiwicmFuZCIsIl9zZXRQb3NpdGlvbiIsIl9wYXJzZUtleVdvcmRzIiwiaiIsImVTaGVlcENoaWxkIiwiU3RhcnQiLCJfbmV4dEVTaGVlcFN0ZXAiLCJyZXBsYWNlIiwicmV0IiwiZXZhbCIsImVyciIsIm1lc3NhZ2UiLCJwYXJlbnROb2RlIiwiYmFzZU5vZGUiLCJub2RlRm91bmQiLCJyZW1vdmVDaGlsZCIsImluZGV4IiwicmVjdCIsIm1hcmdpbiIsImVscyIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInJpZ2h0IiwiZ2V0Q29tcHV0ZWRTdHlsZSIsImJvcmRlclRvcFN0eWxlIiwiZGlzcGxheSIsIm5vZGVOYW1lIiwidmFsdWVOYW1lIiwiZGVmYXVsdFZhbHVlIiwieDEiLCJfZ2V0Tm9kZVZhbHVlIiwieTEiLCJkZWwxIiwieDIiLCJ5MiIsImRlbDIiLCJyZXBlYXQiLCJyZXBlYXRmcm9tIiwiZ3Jhdml0eSIsImJvcmRlciIsInN0ZXBzIiwic2V0VGltZW91dCIsImJpbmQiLCJ0cmFuc2Zvcm0iLCJfZ2V0TmV4dFJhbmRvbU5vZGUiLCJzZXROZXh0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QUFTbkIsS0FBSzhCLFlBQVlnRix3QkFBd0IxQixJQUFNLEVBQzdKcEYsS0FBSzhCLFlBQWMsTUFDVjlCLEtBQUtvQixPQUFTcEIsS0FBSzhCLFlBQVlnRix3QkFBd0IzQixLQUNoRW5GLEtBQUtvQixPQUFTMkQsU0FBUy9FLEtBQUtvQixPQUFTLEdBR3JDcEIsS0FBS29CLE9BQVMyRCxTQUFTL0UsS0FBS29CLE9BQVMsR0FGckNrSCxHQUFVLEdBS1p0SSxLQUFLTyxPQUFPMkUsTUFBTUMsS0FBT0osU0FBUy9FLEtBQUtvQixRQUFVLE9BR2pEa0gsSUFDR3RJLEtBQUtxSSxtQkFBbUJMLEVBQU8sT0FHbkNNLEdBQVdQLEdBQVdBLEVBQVEsSUFBTUEsRUFBUSxHQUFHakUscUJBQXFCLFNBQ25FOUQsS0FBS3FCLE9BQVNyQixLQUFLc0MsUUFBVXRDLEtBQUttQixPQUFTLElBQ3JCLE1BQXBCbkIsS0FBSzhCLFlBQ1B3RyxHQUFVLEVBRUx0SSxLQUFLdUksc0JBQ1JELEdBQVUsRUFDVnRJLEtBQUs4QixZQUFjLE1BSW5Cd0csSUFDR3RJLEtBQUtxSSxtQkFBbUJOLEVBQVEsVUFwRDNDLEdBd0RLTyxJQUNDdEksS0FBS29CLFFBQVVwQixLQUFLa0IsUUFBVXdHLEVBQUssR0FBSzFILEtBQUtvQixPQUFTcEIsS0FBS2dDLFNBQWdCLEVBQUwwRixHQUFVMUgsS0FBS3FCLFFBQVVyQixLQUFLbUIsUUFBVXFHLEVBQUssR0FBS3hILEtBQUtxQixPQUFTckIsS0FBS3NDLFNBQWdCLEVBQUxxRixJQUN4SlcsR0FBVSxPQUNMdEksS0FBS0QsU0FDUkMsS0FBS3dFLHNCQU1YMEQsV0FBV2xJLEtBQUtnRyxnQkFBZ0JtQyxLQUFLbkksTUFBTytFLFNBQVMwQyxHQUFRMUMsVUFBVTZDLEVBQU9ILEdBQVF6SCxLQUFLMEIsY0FBZ0J1RyxRQUl4R25JLE9BbmlCSSIsImZpbGUiOiJlc2hlZXAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbi8qXHJcbiAqIFByb2plY3Q6XHJcbiAqICAgICAgICAgICAgICAgIGVTaGVlcCAtIFdlYnBhZ2VcclxuICpcclxuICogRGF0ZTpcclxuICogICAgICAgICAgICAgICAgMDQuYXByaWwgMjAxOFxyXG4gKlxyXG4gKiBBdXRob3I6XHJcbiAqICAgICAgICAgICAgICAgIEFkcmlhbm8gUGV0cnVjY2kgKGh0dHA6Ly9lc2hlZXAucGV0cnVjY2kuY2gpXHJcbiAqXHJcbiAqIFZlcnNpb246ICAgICAgIDAuNy4xXHJcbiAqXHJcbiAqIEludHJvZHVjdGlvbjpcclxuICogICAgICAgICAgICAgICAgQXMgXCJ3cmFwcGVyXCIgZm9yIHRoZSBPcGVuU291cmNlIEMjIHByb2plY3RcclxuICogICAgICAgICAgICAgICAgKHNlZSBodHRwczovL2dpdGh1Yi5jb20vQWRyaWFub3RpZ2VyL2Rlc2t0b3BQZXQpLFxyXG4gKiAgICAgICAgICAgICAgICB0aGlzIGphdmFzY3JpcHQgXCJjbGFzc1wiIHdhcyB3cml0dGVuIHRvIGdldCB0aGUgYW5pbWF0aW9ucyBhbHNvIGluc2lkZSB5b3VyXHJcbiAqICAgICAgICAgICAgICAgIHdlYnBhZ2UuIEl0IGRvZXNuJ3Qgd29yayBsaWtlIHRoZSBXaW5kb3dzIHZlcnNpb24sIGJ1dCBzaG93IG11Y2ggYW5pbWF0aW9ucyBmcm9tIGl0LlxyXG4gKlxyXG4gKiBEZXNjcmlwdGlvbjpcclxuICogICAgICAgICAgICAgICAgQWRkIGEgd2Fsa2luZyBwZXQgKHNoZWVwIHRvIHlvdXIgaG9tZSBwYWdlKSB3aXRoIGp1c3QgYSBmZXcgbGluZXMgb2YgY29kZSFcclxuICogICAgICAgICAgICAgICAgV2lsbCBhZGQgYSBsb3ZlbHkgc2hlZXAgKHN0cmF5IHNoZWVwKSBhbmQgdGhpcyB3aWxsIHdhbGsgYXJvdW5kIHlvdXIgcGFnZSBhbmQgb3ZlclxyXG4gKiAgICAgICAgICAgICAgICBhbGwgPGhyPnMgYW5kIDxkaXY+cyB3aXRoIGEgYm9yZGVyLiBZb3UgY2FuIGFsc28gc2VsZWN0IGFub3RoZXIgYW5pbWF0aW9uLCB1c2luZyB5b3VyXHJcbiAqICAgICAgICAgICAgICAgIHBlcnNvbmFsIFhNTCBmaWxlIG9yIG9uZSBmcm9tIHRoZSBkYXRhYmFzZS5cclxuICpcclxuICogSG93IHRvIHVzZTpcclxuICogICAgICAgICAgICAgICAgQWRkIHRoaXMgbGluZSBpbiB5b3VyIDxoZWFkZXI+OlxyXG4gKiAgICAgICAgICAgICAgICA8c2NyaXB0IHNyYz1cImh0dHA6Ly9lc2hlZXAucGV0cnVjY2kuY2gvc2NyaXB0L0Rlc2t0b3BQZXQuanNcIj48L3NjcmlwdD5cclxuICogICAgICAgICAgICAgICAgQWRkIHRoaXMgbGluZXMgaW4geW91ciA8Ym9keT4gKGF0IHRoZSBlbmQgaWYgcG9zc2libGUpOlxyXG4gKiAgICAgICAgICAgICAgICA8c2NyaXB0PlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwZXQgPSBuZXcgRVNoZWVwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGV0LlN0YXJ0KCdodHRwOi8vZXNoZWVwLnBldHJ1Y2NpLmNoL3NjcmlwdC9hbmltYXRpb24ueG1sJyk7XHJcbiAgICAgICAgICAgICAgICAgIDwvc2NyaXB0PlxyXG4gKiAgICAgICAgICAgICAgICBUaGF0J3MgYWxsIVxyXG4gKlxyXG4gKiBSZXF1aXJlbWVudDpcclxuICogICAgICAgICAgICAgICAgVGVzdGVkIG9uIElFMTEsIEVkZ2UgYW5kIE9wZXJhXHJcbiAqXHJcbiAqIENoYW5nZWxvZzpcclxuICogICAgICAgICAgICAgICAgVmVyc2lvbiAwLjcuMSAtIDA0LjA0LjIwMTg6XHJcbiAqICAgICAgICAgICAgICAgICAgLSBBZGQgbWF4LXdpZHRoOiBub25lIHRvIGVuc3VyZSB0aGUgaW1hZ2UgaXMgcHJvcGVybHkgc2hvd25cclxuICogICAgICAgICAgICAgICAgVmVyc2lvbiAwLjcgLSAxMy4xMS4yMDE3OlxyXG4gKiAgICAgICAgICAgICAgICAgIC0gYmV0dGVyIEphdmFzY3JpcHQgc3RydWN0dXJlXHJcbiAqICAgICAgICAgICAgICAgICAgLSBHaXRIdWIgdmVyc2lvbiAoaHR0cHM6Ly9naXRodWIuY29tL0Fkcmlhbm90aWdlci93ZWItZXNoZWVwKVxyXG4gKiAgICAgICAgICAgICAgICAgIC0gQ2hpbGRzIGFuaW1hdGlvbnMgYWRkZWRcclxuICogICAgICAgICAgICAgICAgICAtIEJldHRlciBjb21tZW50c1xyXG4gKiAgICAgICAgICAgICAgICAgIC0gUmVwbGFjZWQgYWxlcnRzIHdpdGggY29uc29sZS5lcnJvclxyXG4gKiAgICAgICAgICAgICAgICBWZXJzaW9uIDAuNSAtIDEyLjA3LjIwMTc6XHJcbiAqICAgICAgICAgICAgICAgICAgLSBhbmltYXRpb25zIHN0YXJ0cyBvbmx5IG9uY2UgdGhlIGltYWdlIHdhcyBsb2FkZWQgKHRoYW5rcyBSZWRTcGFycjB3KVxyXG4gKiAgICAgICAgICAgICAgICBWZXJzaW9uIDAueDpcclxuICogICAgICAgICAgICAgICAgICAtIHN0aWxsIGJldGEgdmVyc2lvbnMuLi5cclxuICovXG5cbnZhciBWRVJTSU9OID0gJzAuNy4xJzsgLy8gd2ViIGVTaGVlcCB2ZXJzaW9uXG52YXIgQUNUSVZBVEVfREVCVUcgPSBmYWxzZTsgLy8gc2hvdyBsb2cgb24gY29uc29sZVxudmFyIERFRkFVTFRfWE1MID0gXCJodHRwOi8vZXNoZWVwLnBldHJ1Y2NpLmNoL3NjcmlwdC9hbmltYXRpb24ucGhwXCI7IC8vIGRlZmF1bHQgWE1MIGFuaW1hdGlvblxudmFyIENPTExJU0lPTl9XSVRIID0gW1wiZGl2XCIsIFwiaHJcIl07IC8vIGVsZW1lbnRzIG9uIHBhZ2UgdG8gZGV0ZWN0IGZvciBjb2xsaXNpb25zXG5cbi8qXHJcbiAqIGVTaGVlcCBjbGFzcy5cclxuICogQ3JlYXRlIGEgbmV3IGNsYXNzIG9mIHRoaXMgdHlwZSBpZiB5b3Ugd2FudCBhIG5ldyBwZXQuIFdpbGwgY3JlYXRlIHRoZSBjb21wb25lbnRzIGZvciB0aGUgcGV0LlxyXG4gKiBPbmNlIGNyZWF0ZWQsIHlvdSBjYW4gY2FsbCBbdmFyaWFibGVOYW1lXS5TdGFydCgpIHRvIHN0YXJ0IHRoZSBhbmltYXRpb24gd2l0aCB5b3VyIGRlc2lyZWQgcGV0LlxyXG4gKi9cblxudmFyIGVTaGVlcCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gZVNoZWVwKGlzQ2hpbGQpIHtcbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgZVNoZWVwKTtcblxuICAgIC8vIENPUlM6IENyb3NzIGNhbGxzIGFyZSBub3QgYWNjZXB0ZWQgYnkgbmV3IGJyb3dzZXJzLlxuICAgIC8vIFRoaXMgUEhQLXNjcmlwdCBhbGxvd3MgdG8gY2FsbCB0aGUgcGFnZSBhbHNvIGZyb20gb3RoZXIgZG9tYWluc1xuICAgIHRoaXMuYW5pbWF0aW9uRmlsZSA9IERFRkFVTFRfWE1MO1xuXG4gICAgdGhpcy5pZCA9IERhdGUubm93KCkgKyBNYXRoLnJhbmRvbSgpO1xuXG4gICAgdGhpcy5ET01kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpOyAvLyBEaXYgYWRkZWQgdG8gd2VicGFnZSwgY29udGFpbmluZyB0aGUgc2hlZXBcbiAgICB0aGlzLkRPTWRpdi5zZXRBdHRyaWJ1dGUoXCJpZFwiLCB0aGlzLmlkKTtcbiAgICB0aGlzLkRPTWltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7IC8vIFRpbGUgaW1hZ2UsIHdpbGwgYmUgcG9zaXRpb25lZCBpbnNpZGUgdGhlIGRpdlxuICAgIHRoaXMuRE9NaW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7IC8vIGFib3V0IGRpYWxvZywgaWYgeW91IHByZXNzIG9uIHRoZSBzaGVlcFxuXG4gICAgdGhpcy5wYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7IC8vIFhNTCBwYXJzZXJcbiAgICB0aGlzLnhtbERvYyA9IG51bGw7IC8vIHBhcnNlZCBYTUwgRG9jdW1lbnRcblxuICAgIHRoaXMuaXNDaGlsZCA9IGlzQ2hpbGQgIT0gbnVsbDsgLy8gQ2hpbGQgd2lsbCBiZSByZW1vdmVkIG9uY2UgdGhleSByZWFjaGVkIHRoZSBlbmRcblxuICAgIHRoaXMudGlsZXNYID0gMTsgLy8gUXVhbnRpdHkgb2YgaW1hZ2VzIGluc2lkZSBUaWxlXG4gICAgdGhpcy50aWxlc1kgPSAxOyAvLyBRdWFudGl0eSBvZiBpbWFnZXMgaW5zaWRlIFRpbGVcbiAgICB0aGlzLmltYWdlVyA9IDE7IC8vIFdpZHRoIG9mIHRoZSBzcHJpdGUgaW1hZ2VcbiAgICB0aGlzLmltYWdlSCA9IDE7IC8vIEhlaWdodCBvZiB0aGUgc3ByaXRlIGltYWdlXG4gICAgdGhpcy5pbWFnZVggPSAxOyAvLyBQb3NpdGlvbiBvZiBzcHJpdGUgaW5zaWRlIHdlYnBhZ2VcbiAgICB0aGlzLmltYWdlWSA9IDE7IC8vIFBvc2l0aW9uIG9mIHNwcml0ZSBpbnNpZGUgd2VicGFnZVxuICAgIHRoaXMuZmxpcHBlZCA9IGZhbHNlOyAvLyBpZiBzcHJpdGUgaXMgZmxpcHBlZFxuICAgIHRoaXMuZHJhZ2dpbmcgPSBmYWxzZTsgLy8gaWYgdXNlciBpcyBkcmFnZ2luZyB0aGUgc2hlZXBcbiAgICB0aGlzLmluZm9ib3ggPSBmYWxzZTsgLy8gaWYgaW5mb2JveCBpcyB2aXNpYmxlXG4gICAgdGhpcy5hbmltYXRpb25JZCA9IDA7IC8vIGN1cnJlbnQgYW5pbWF0aW9uIElEXG4gICAgdGhpcy5hbmltYXRpb25TdGVwID0gMDsgLy8gY3VycmVudCBhbmltYXRpb24gc3RlcFxuICAgIHRoaXMuYW5pbWF0aW9uTm9kZSA9IG51bGw7IC8vIGN1cnJlbnQgYW5pbWF0aW9uIERPTSBub2RlXG4gICAgdGhpcy5zcHJpdGUgPSBuZXcgSW1hZ2UoKTsgLy8gc3ByaXRlIGltYWdlIChUaWxlcylcbiAgICB0aGlzLkhUTUxlbGVtZW50ID0gbnVsbDsgLy8gdGhlIEhUTUwgZWxlbWVudCB3aGVyZSB0aGUgcGV0IGlzIHdhbGtpbmcgb25cbiAgICB0aGlzLnJhbmRTID0gTWF0aC5yYW5kb20oKSAqIDEwMDsgLy8gcmFuZG9tIHZhbHVlLCB3aWxsIGNoYW5nZSB3aGVuIHBhZ2UgaXMgcmVsb2FkZWRcblxuICAgIHRoaXMuc2NyZWVuVyA9IHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCB8fCBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoOyAvLyB3aW5kb3cgd2lkdGhcblxuICAgIHRoaXMuc2NyZWVuSCA9IHdpbmRvdy5pbm5lckhlaWdodCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IHx8IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0OyAvLyB3aW5kb3cgaGVpZ2h0XG4gIH1cblxuICAvKlxyXG4gICAqIFN0YXJ0IG5ldyBhbmltYXRpb24gb24gdGhlIHBhZ2UuXHJcbiAgICogaWYgYW5pbWF0aW9uIGlzIG5vdCBzZXQsIHRoZSBkZWZhdWx0IHNoZWVwIHdpbGwgYmUgdGFrZW5cclxuICAgKi9cblxuXG4gIF9jcmVhdGVDbGFzcyhlU2hlZXAsIFt7XG4gICAga2V5OiBcIlN0YXJ0XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIFN0YXJ0KGFuaW1hdGlvbikge1xuICAgICAgaWYgKHR5cGVvZiBhbmltYXRpb24gIT09ICd1bmRlZmluZWQnICYmIGFuaW1hdGlvbiAhPSBudWxsKSB7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uRmlsZSA9IGFuaW1hdGlvbjtcbiAgICAgIH1cblxuICAgICAgdmFyIGFqYXggPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgIHZhciBzaGVlcENsYXNzID0gdGhpcztcblxuICAgICAgYWpheC5vcGVuKFwiR0VUXCIsIHRoaXMuYW5pbWF0aW9uRmlsZSwgdHJ1ZSk7XG4gICAgICBhamF4LmFkZEV2ZW50TGlzdGVuZXIoXCJyZWFkeXN0YXRlY2hhbmdlXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMucmVhZHlTdGF0ZSA9PSA0KSB7XG4gICAgICAgICAgaWYgKHRoaXMuc3RhdHVzID09IDIwMClcbiAgICAgICAgICAgIC8vIHN1Y2Nlc3NmdWxseSBsb2FkZWQgWE1MLCBwYXJzZSBpdCBhbmQgY3JlYXRlIGZpcnN0IGVzaGVlcC5cbiAgICAgICAgICAgIHNoZWVwQ2xhc3MuX3BhcnNlWE1MKHRoaXMucmVzcG9uc2VUZXh0KTtlbHNlIGNvbnNvbGUuZXJyb3IoXCJYTUwgbm90IGF2YWlsYWJsZTpcIiArIHRoaXMuc3RhdHVzVGV4dCArIFwiXFxuXCIgKyB0aGlzLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgYWpheC5zZW5kKG51bGwpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJyZW1vdmVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlKCkge1xuICAgICAgdGhpcy5ET01kaXYgPSB0aGlzLkRPTWltZyA9IHRoaXMuRE9NaW5mbyA9IG51bGw7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmlkKS5vdXRlckhUTUwgPSAnJztcbiAgICB9XG5cbiAgICAvKlxyXG4gICAgICogUGFyc2UgbG9hZGVkIFhNTCwgY29udGFpbnMgc3Bhd24sIGFuaW1hdGlvbnMgYW5kIGNoaWxkc1xyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJfcGFyc2VYTUxcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gX3BhcnNlWE1MKHRleHQpIHtcbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgIHRoaXMueG1sRG9jID0gdGhpcy5wYXJzZXIucGFyc2VGcm9tU3RyaW5nKHRleHQsICd0ZXh0L3htbCcpO1xuICAgICAgdmFyIGltYWdlID0gdGhpcy54bWxEb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ltYWdlJylbMF07XG4gICAgICB0aGlzLnRpbGVzWCA9IGltYWdlLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwidGlsZXN4XCIpWzBdLnRleHRDb250ZW50O1xuICAgICAgdGhpcy50aWxlc1kgPSBpbWFnZS5nZXRFbGVtZW50c0J5VGFnTmFtZShcInRpbGVzeVwiKVswXS50ZXh0Q29udGVudDtcbiAgICAgIC8vIEV2ZW50IGxpc3RlbmVyOiBTcHJpdGUgd2FzIGxvYWRlZCA9PlxuICAgICAgLy8gICBwbGF5IGFuaW1hdGlvbiBvbmx5IHdoZW4gdGhlIHNwcml0ZSBpcyBsb2FkZWRcbiAgICAgIHRoaXMuc3ByaXRlLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKEFDVElWQVRFX0RFQlVHKSBjb25zb2xlLmxvZyhcIlNwcml0ZSBpbWFnZSBsb2FkZWRcIik7XG4gICAgICAgIHZhciBhdHRyaWJ1dGUgPSBcIndpZHRoOlwiICsgX3RoaXMuc3ByaXRlLndpZHRoICsgXCJweDtcIiArIFwiaGVpZ2h0OlwiICsgX3RoaXMuc3ByaXRlLmhlaWdodCArIFwicHg7XCIgKyBcInBvc2l0aW9uOmFic29sdXRlO1wiICsgXCJ0b3A6MHB4O1wiICsgXCJsZWZ0OjBweDtcIiArIFwibWF4LXdpZHRoOiBub25lO1wiO1xuICAgICAgICBfdGhpcy5ET01pbWcuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgYXR0cmlidXRlKTtcbiAgICAgICAgLy8gcHJldmVudCB0byBtb3ZlIGltYWdlICh3aWxsIHNob3cgdGhlIGVudGlyZSBzcHJpdGUgc2hlZXQgaWYgbm90IGNhdGNoZWQpXG4gICAgICAgIF90aGlzLkRPTWltZy5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ3N0YXJ0XCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO3JldHVybiBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICAgIF90aGlzLmltYWdlVyA9IF90aGlzLnNwcml0ZS53aWR0aCAvIF90aGlzLnRpbGVzWDtcbiAgICAgICAgX3RoaXMuaW1hZ2VIID0gX3RoaXMuc3ByaXRlLmhlaWdodCAvIF90aGlzLnRpbGVzWTtcbiAgICAgICAgLy9pZih0eXBlb2YgdGhpcy5pbWFnZVggPT0gJ3VuZGVmaW5lZCcpIHRoaXMuaW1hZ2VYID0gMDtcbiAgICAgICAgLy9pZih0eXBlb2YgdGhpcy5pbWFnZVkgPT0gJ3VuZGVmaW5lZCcpIHRoaXMuaW1hZ2VZID0gdGhpcy5zY3JlZW5IIC0gdGhpcy5zcHJpdGUuaGVpZ2h0IC8gdGhpcy50aWxlc1k7XG4gICAgICAgIGF0dHJpYnV0ZSA9IFwid2lkdGg6XCIgKyBfdGhpcy5pbWFnZVcgKyBcInB4O1wiICsgXCJoZWlnaHQ6XCIgKyBfdGhpcy5pbWFnZUggKyBcInB4O1wiICsgXCJwb3NpdGlvbjpmaXhlZDtcIiArIFwidG9wOlwiICsgX3RoaXMuaW1hZ2VZICsgXCJweDtcIiArIFwibGVmdDpcIiArIF90aGlzLmltYWdlWCArIFwicHg7XCIgKyBcInRyYW5zZm9ybTpyb3RhdGV5KDBkZWcpO1wiICsgXCJjdXJzb3I6bW92ZTtcIiArIFwiei1pbmRleDoyMDAwO1wiICsgXCJvdmVyZmxvdzpoaWRkZW47XCI7XG4gICAgICAgIF90aGlzLkRPTWRpdi5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBhdHRyaWJ1dGUpO1xuICAgICAgICBfdGhpcy5ET01kaXYuYXBwZW5kQ2hpbGQoX3RoaXMuRE9NaW1nKTtcblxuICAgICAgICBpZiAoX3RoaXMuaXNDaGlsZCkgX3RoaXMuX3NwYXduQ2hpbGQoKTtlbHNlIF90aGlzLl9zcGF3bkVTaGVlcCgpO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuc3ByaXRlLnNyYyA9ICdkYXRhOmltYWdlL3BuZztiYXNlNjQsJyArIGltYWdlLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwicG5nXCIpWzBdLnRleHRDb250ZW50O1xuICAgICAgdGhpcy5ET01pbWcuc2V0QXR0cmlidXRlKFwic3JjXCIsIHRoaXMuc3ByaXRlLnNyYyk7XG5cbiAgICAgIC8vIE1vdXNlIG1vdmUgb3ZlciBlU2hlZXAsIGNoZWNrIGlmIGVTaGVlcCBzaG91bGQgYmUgbW92ZWQgb3ZlciB0aGUgc2NyZWVuXG4gICAgICB0aGlzLkRPTWRpdi5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmICghX3RoaXMuZHJhZ2dpbmcgJiYgZS5idXR0b25zID09IDEgJiYgZS5idXR0b24gPT0gMCkge1xuICAgICAgICAgIF90aGlzLmRyYWdnaW5nID0gdHJ1ZTtcbiAgICAgICAgICBfdGhpcy5IVE1MZWxlbWVudCA9IG51bGw7XG4gICAgICAgICAgdmFyIGNoaWxkc1Jvb3QgPSBfdGhpcy54bWxEb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2FuaW1hdGlvbnMnKVswXTtcbiAgICAgICAgICB2YXIgY2hpbGRzID0gY2hpbGRzUm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYW5pbWF0aW9uJyk7XG4gICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBjaGlsZHMubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgIGlmIChjaGlsZHNba10uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ25hbWUnKVswXS50ZXh0Q29udGVudCA9PSBcImRyYWdcIikge1xuICAgICAgICAgICAgICBfdGhpcy5hbmltYXRpb25JZCA9IGNoaWxkc1trXS5nZXRBdHRyaWJ1dGUoXCJpZFwiKTtcbiAgICAgICAgICAgICAgX3RoaXMuYW5pbWF0aW9uU3RlcCA9IDA7XG4gICAgICAgICAgICAgIF90aGlzLmFuaW1hdGlvbk5vZGUgPSBjaGlsZHNba107XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICAvLyBBZGQgZXZlbnQgbGlzdGVuZXIgdG8gYm9keSwgaWYgbW91c2UgbW92ZWQgdG9vIGZhc3Qgb3ZlciB0aGUgZHJhZ2dpbmcgZVNoZWVwXG4gICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKF90aGlzLmRyYWdnaW5nKSB7XG4gICAgICAgICAgX3RoaXMuaW1hZ2VYID0gcGFyc2VJbnQoZS5jbGllbnRYKSAtIF90aGlzLmltYWdlVyAvIDI7XG4gICAgICAgICAgX3RoaXMuaW1hZ2VZID0gcGFyc2VJbnQoZS5jbGllbnRZKSAtIF90aGlzLmltYWdlSCAvIDI7XG5cbiAgICAgICAgICBfdGhpcy5ET01kaXYuc3R5bGUubGVmdCA9IF90aGlzLmltYWdlWCArIFwicHhcIjtcbiAgICAgICAgICBfdGhpcy5ET01kaXYuc3R5bGUudG9wID0gX3RoaXMuaW1hZ2VZICsgXCJweFwiO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIC8vIFdpbmRvdyByZXNpemVkLCByZWNhbGN1bGF0ZSBlU2hlZXAgYm91bmRzXG4gICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBfdGhpcy5zY3JlZW5XID0gd2luZG93LmlubmVyV2lkdGggfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIHx8IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGg7XG5cbiAgICAgICAgX3RoaXMuc2NyZWVuSCA9IHdpbmRvdy5pbm5lckhlaWdodCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IHx8IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0O1xuXG4gICAgICAgIGlmIChfdGhpcy5pbWFnZVkgKyBfdGhpcy5pbWFnZUggPiBfdGhpcy5zY3JlZW5IKSB7XG4gICAgICAgICAgX3RoaXMuaW1hZ2VZID0gX3RoaXMuc2NyZWVuSCAtIF90aGlzLmltYWdlSDtcbiAgICAgICAgICBfdGhpcy5ET01kaXYuc3R5bGUudG9wID0gX3RoaXMuaW1hZ2VZICsgXCJweFwiO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfdGhpcy5pbWFnZVggKyBfdGhpcy5pbWFnZVcgPiBfdGhpcy5zY3JlZW5XKSB7XG4gICAgICAgICAgX3RoaXMuaW1hZ2VYID0gX3RoaXMuc2NyZWVuVyAtIF90aGlzLmltYWdlVztcbiAgICAgICAgICBfdGhpcy5ET01kaXYuc3R5bGUubGVmdCA9IF90aGlzLmltYWdlWCArIFwicHhcIjtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICAvLyBEb24ndCBhbGxvdyBjb250ZXh0bWVudSBvdmVyIHRoZSBzaGVlcFxuICAgICAgdGhpcy5ET01kaXYuYWRkRXZlbnRMaXN0ZW5lcihcImNvbnRleHRtZW51XCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG4gICAgICAvLyBNb3VzZSByZWxlYXNlZFxuICAgICAgdGhpcy5ET01kaXYuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoX3RoaXMuZHJhZ2dpbmcpIHtcbiAgICAgICAgICBfdGhpcy5kcmFnZ2luZyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLkRPTWRpdik7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcIl9zZXRQb3NpdGlvblwiLFxuXG5cbiAgICAvKlxyXG4gICAgICogU2V0IG5ldyBwb3NpdGlvbiBmb3IgdGhlIHBldFxyXG4gICAgICogSWYgYWJzb2x1dGUgaXMgdHJ1ZSwgdGhlIHggYW5kIHkgY29vcmRpbmF0ZXMgYXJlIHVzZWQgYXMgYWJzb2x1dGUgdmFsdWVzLlxyXG4gICAgICogSWYgZmFsc2UsIHggYW5kIHkgYXJlIGFkZGVkIHRvIHRoZSBjdXJyZW50IHBvc2l0aW9uXHJcbiAgICAgKi9cbiAgICB2YWx1ZTogZnVuY3Rpb24gX3NldFBvc2l0aW9uKHgsIHksIGFic29sdXRlKSB7XG4gICAgICBpZiAodGhpcy5ET01kaXYpIHtcbiAgICAgICAgaWYgKGFic29sdXRlKSB7XG4gICAgICAgICAgdGhpcy5pbWFnZVggPSBwYXJzZUludCh4KTtcbiAgICAgICAgICB0aGlzLmltYWdlWSA9IHBhcnNlSW50KHkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuaW1hZ2VYID0gcGFyc2VJbnQodGhpcy5pbWFnZVgpICsgcGFyc2VJbnQoeCk7XG4gICAgICAgICAgdGhpcy5pbWFnZVkgPSBwYXJzZUludCh0aGlzLmltYWdlWSkgKyBwYXJzZUludCh5KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLkRPTWRpdi5zdHlsZS5sZWZ0ID0gdGhpcy5pbWFnZVggKyBcInB4XCI7XG4gICAgICAgIHRoaXMuRE9NZGl2LnN0eWxlLnRvcCA9IHRoaXMuaW1hZ2VZICsgXCJweFwiO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qXHJcbiAgICAgKiBTcGF3biBuZXcgZXNoZWVwLCB0aGlzIGlzIGNhbGxlZCBpZiB0aGUgWE1MIHdhcyBsb2FkZWQgc3VjY2Vzc2Z1bGx5XHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcIl9zcGF3bkVTaGVlcFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBfc3Bhd25FU2hlZXAoKSB7XG4gICAgICB2YXIgc3Bhd25zUm9vdCA9IHRoaXMueG1sRG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzcGF3bnMnKVswXTtcbiAgICAgIHZhciBzcGF3bnMgPSBzcGF3bnNSb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzcGF3bicpO1xuICAgICAgdmFyIHByb2IgPSAwO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGF3bnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgcHJvYiArPSBwYXJzZUludChzcGF3bnNbMF0uZ2V0QXR0cmlidXRlKFwicHJvYmFiaWxpdHlcIikpO1xuICAgICAgfXZhciByYW5kID0gTWF0aC5yYW5kb20oKSAqIHByb2I7XG4gICAgICBwcm9iID0gMDtcbiAgICAgIGZvciAoaSA9IDA7IGkgPCBzcGF3bnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgcHJvYiArPSBwYXJzZUludChzcGF3bnNbaV0uZ2V0QXR0cmlidXRlKFwicHJvYmFiaWxpdHlcIikpO1xuICAgICAgICBpZiAocHJvYiA+PSByYW5kIHx8IGkgPT0gc3Bhd25zLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICB0aGlzLl9zZXRQb3NpdGlvbih0aGlzLl9wYXJzZUtleVdvcmRzKHNwYXduc1tpXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgneCcpWzBdLnRleHRDb250ZW50KSwgdGhpcy5fcGFyc2VLZXlXb3JkcyhzcGF3bnNbaV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3knKVswXS50ZXh0Q29udGVudCksIHRydWUpO1xuICAgICAgICAgIGlmIChBQ1RJVkFURV9ERUJVRykgY29uc29sZS5sb2coXCJTcGF3bjogXCIgKyB0aGlzLmltYWdlWCArIFwiLCBcIiArIHRoaXMuaW1hZ2VZKTtcbiAgICAgICAgICB0aGlzLmFuaW1hdGlvbklkID0gc3Bhd25zW2ldLmdldEVsZW1lbnRzQnlUYWdOYW1lKCduZXh0JylbMF0udGV4dENvbnRlbnQ7XG4gICAgICAgICAgdGhpcy5hbmltYXRpb25TdGVwID0gMDtcbiAgICAgICAgICB2YXIgY2hpbGRzUm9vdCA9IHRoaXMueG1sRG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhbmltYXRpb25zJylbMF07XG4gICAgICAgICAgdmFyIGNoaWxkcyA9IGNoaWxkc1Jvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2FuaW1hdGlvbicpO1xuICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgY2hpbGRzLmxlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICBpZiAoY2hpbGRzW2tdLmdldEF0dHJpYnV0ZShcImlkXCIpID09IHRoaXMuYW5pbWF0aW9uSWQpIHtcbiAgICAgICAgICAgICAgdGhpcy5hbmltYXRpb25Ob2RlID0gY2hpbGRzW2tdO1xuXG4gICAgICAgICAgICAgIC8vIENoZWNrIGlmIGNoaWxkIHNob3VsZCBiZSBsb2FkZWQgdG9naGV0aGVyIHdpdGggdGhpcyBhbmltYXRpb25cbiAgICAgICAgICAgICAgdmFyIGNoaWxkc1Jvb3QgPSB0aGlzLnhtbERvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgnY2hpbGRzJylbMF07XG4gICAgICAgICAgICAgIHZhciBjaGlsZHMgPSBjaGlsZHNSb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdjaGlsZCcpO1xuICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNoaWxkcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIGlmIChjaGlsZHNbal0uZ2V0QXR0cmlidXRlKFwiYW5pbWF0aW9uaWRcIikgPT0gdGhpcy5hbmltYXRpb25JZCkge1xuICAgICAgICAgICAgICAgICAgaWYgKEFDVElWQVRFX0RFQlVHKSBjb25zb2xlLmxvZyhcIkNoaWxkIGZyb20gU3Bhd25cIik7XG4gICAgICAgICAgICAgICAgICB2YXIgZVNoZWVwQ2hpbGQgPSBuZXcgZVNoZWVwKHRydWUpO1xuICAgICAgICAgICAgICAgICAgZVNoZWVwQ2hpbGQuYW5pbWF0aW9uSWQgPSBjaGlsZHNbal0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ25leHQnKVswXS50ZXh0Q29udGVudDtcbiAgICAgICAgICAgICAgICAgIHZhciB4ID0gY2hpbGRzW2pdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd4JylbMF0udGV4dENvbnRlbnQ7IC8vXG4gICAgICAgICAgICAgICAgICB2YXIgeSA9IGNoaWxkc1tqXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgneScpWzBdLnRleHRDb250ZW50O1xuICAgICAgICAgICAgICAgICAgZVNoZWVwQ2hpbGQuX3NldFBvc2l0aW9uKHRoaXMuX3BhcnNlS2V5V29yZHMoeCksIHRoaXMuX3BhcnNlS2V5V29yZHMoeSksIHRydWUpO1xuICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgYW5pbWF0aW9uXG4gICAgICAgICAgICAgICAgICBlU2hlZXBDaGlsZC5TdGFydCh0aGlzLmFuaW1hdGlvbkZpbGUpO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gUGxheSBuZXh0IHN0ZXBcbiAgICAgIHRoaXMuX25leHRFU2hlZXBTdGVwKCk7XG4gICAgfVxuXG4gICAgLypcclxuICAgICAqIExpa2Ugc3Bhd25FU2hlZXAsIGJ1dCBmb3IgQ2hpbGRzXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcIl9zcGF3bkNoaWxkXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIF9zcGF3bkNoaWxkKCkge1xuICAgICAgdmFyIGNoaWxkc1Jvb3QgPSB0aGlzLnhtbERvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYW5pbWF0aW9ucycpWzBdO1xuICAgICAgdmFyIGNoaWxkcyA9IGNoaWxkc1Jvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2FuaW1hdGlvbicpO1xuICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBjaGlsZHMubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgaWYgKGNoaWxkc1trXS5nZXRBdHRyaWJ1dGUoXCJpZFwiKSA9PSB0aGlzLmFuaW1hdGlvbklkKSB7XG4gICAgICAgICAgdGhpcy5hbmltYXRpb25Ob2RlID0gY2hpbGRzW2tdO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLl9uZXh0RVNoZWVwU3RlcCgpO1xuICAgIH1cblxuICAgIC8vIFBhcnNlIHRoZSBodW1hbiByZWFkYWJsZSBleHByZXNzaW9uIGZyb20gWE1MIHRvIGEgY29tcHV0ZXIgcmVhZGFibGUgZXhwcmVzc2lvblxuXG4gIH0sIHtcbiAgICBrZXk6IFwiX3BhcnNlS2V5V29yZHNcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gX3BhcnNlS2V5V29yZHModmFsdWUpIHtcbiAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvc2NyZWVuVy9nLCB0aGlzLnNjcmVlblcpO1xuICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9zY3JlZW5IL2csIHRoaXMuc2NyZWVuSCk7XG4gICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL2FyZWFXL2csIHRoaXMuc2NyZWVuSCk7XG4gICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL2FyZWFIL2csIHRoaXMuc2NyZWVuSCk7XG4gICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL2ltYWdlVy9nLCB0aGlzLmltYWdlVyk7XG4gICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL2ltYWdlSC9nLCB0aGlzLmltYWdlSCk7XG4gICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL3JhbmRvbS9nLCBNYXRoLnJhbmRvbSgpICogMTAwKTtcbiAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvcmFuZFMvZywgdGhpcy5yYW5kUyk7XG4gICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL2ltYWdlWC9nLCB0aGlzLmltYWdlWCk7XG4gICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL2ltYWdlWS9nLCB0aGlzLmltYWdlWSk7XG5cbiAgICAgIHZhciByZXQgPSAwO1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0ID0gZXZhbCh2YWx1ZSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlVuYWJsZSB0byBwYXJzZSB0aGlzIHBvc2l0aW9uOiBcXG4nXCIgKyB2YWx1ZSArIFwiJ1xcbiBFcnJvciBtZXNzYWdlOiBcXG5cIiArIGVyci5tZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuXG4gICAgLypcclxuICAgICAqIE9uY2UgdGhlIGFuaW1hdGlvbiBpcyBvdmVyLCBnZXQgdGhlIG5leHQgYW5pbWF0aW9uIHRvIHBsYXlcclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiX2dldE5leHRSYW5kb21Ob2RlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXROZXh0UmFuZG9tTm9kZShwYXJlbnROb2RlKSB7XG4gICAgICB2YXIgYmFzZU5vZGUgPSBwYXJlbnROb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCduZXh0Jyk7XG4gICAgICB2YXIgY2hpbGRzUm9vdCA9IHRoaXMueG1sRG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhbmltYXRpb25zJylbMF07XG4gICAgICB2YXIgY2hpbGRzID0gY2hpbGRzUm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYW5pbWF0aW9uJyk7XG4gICAgICB2YXIgcHJvYiA9IDA7XG4gICAgICB2YXIgbm9kZUZvdW5kID0gZmFsc2U7XG5cbiAgICAgIC8vIG5vIG1vcmUgYW5pbWF0aW9ucyAoaXQgd2FzIHRoZSBsYXN0IG9uZSlcbiAgICAgIGlmIChiYXNlTm9kZS5sZW5ndGggPT0gMCkge1xuICAgICAgICAvLyBJZiBpdCBpcyBhIGNoaWxkLCByZW1vdmUgdGhlIGNoaWxkIGZyb20gZG9jdW1lbnRcbiAgICAgICAgaWYgKHRoaXMuaXNDaGlsZCkge1xuICAgICAgICAgIC8vIHJlbW92ZSBjaGlsZFxuICAgICAgICAgIGlmIChBQ1RJVkFURV9ERUJVRykgY29uc29sZS5sb2coXCJSZW1vdmUgY2hpbGRcIik7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLkRPTWluZm8pO1xuICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5ET01kaXYpO1xuICAgICAgICAgIGRlbGV0ZSB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIC8vIGVsc2UsIHNwYXduIHNoZWVwIGFnYWluXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fc3Bhd25FU2hlZXAoKTtcbiAgICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBiYXNlTm9kZS5sZW5ndGg7IGsrKykge1xuICAgICAgICBwcm9iICs9IHBhcnNlSW50KGJhc2VOb2RlW2tdLmdldEF0dHJpYnV0ZShcInByb2JhYmlsaXR5XCIpKTtcbiAgICAgIH1cbiAgICAgIHZhciByYW5kID0gTWF0aC5yYW5kb20oKSAqIHByb2I7XG4gICAgICB2YXIgaW5kZXggPSAwO1xuICAgICAgcHJvYiA9IDA7XG4gICAgICBmb3IgKGsgPSAwOyBrIDwgYmFzZU5vZGUubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgcHJvYiArPSBwYXJzZUludChiYXNlTm9kZVtrXS5nZXRBdHRyaWJ1dGUoXCJwcm9iYWJpbGl0eVwiKSk7XG4gICAgICAgIGlmIChwcm9iID49IHJhbmQpIHtcbiAgICAgICAgICBpbmRleCA9IGs7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAoayA9IDA7IGsgPCBjaGlsZHMubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgaWYgKGNoaWxkc1trXS5nZXRBdHRyaWJ1dGUoXCJpZFwiKSA9PSBiYXNlTm9kZVtpbmRleF0udGV4dENvbnRlbnQpIHtcbiAgICAgICAgICB0aGlzLmFuaW1hdGlvbklkID0gY2hpbGRzW2tdLmdldEF0dHJpYnV0ZShcImlkXCIpO1xuICAgICAgICAgIHRoaXMuYW5pbWF0aW9uU3RlcCA9IDA7XG4gICAgICAgICAgdGhpcy5hbmltYXRpb25Ob2RlID0gY2hpbGRzW2tdO1xuICAgICAgICAgIG5vZGVGb3VuZCA9IHRydWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKG5vZGVGb3VuZCkgLy8gY3JlYXRlIENoaWxkLCBpZiBwcmVzZW50XG4gICAgICAgIHtcbiAgICAgICAgICB2YXIgY2hpbGRzUm9vdCA9IHRoaXMueG1sRG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdjaGlsZHMnKVswXTtcbiAgICAgICAgICB2YXIgY2hpbGRzID0gY2hpbGRzUm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnY2hpbGQnKTtcbiAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgY2hpbGRzLmxlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICBpZiAoY2hpbGRzW2tdLmdldEF0dHJpYnV0ZShcImFuaW1hdGlvbmlkXCIpID09IHRoaXMuYW5pbWF0aW9uSWQpIHtcbiAgICAgICAgICAgICAgaWYgKEFDVElWQVRFX0RFQlVHKSBjb25zb2xlLmxvZyhcIkNoaWxkIGZyb20gQW5pbWF0aW9uXCIpO1xuICAgICAgICAgICAgICB2YXIgZVNoZWVwQ2hpbGQgPSBuZXcgZVNoZWVwKHRydWUpO1xuICAgICAgICAgICAgICBlU2hlZXBDaGlsZC5hbmltYXRpb25JZCA9IGNoaWxkc1trXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnbmV4dCcpWzBdLnRleHRDb250ZW50O1xuICAgICAgICAgICAgICB2YXIgeCA9IGNoaWxkc1trXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgneCcpWzBdLnRleHRDb250ZW50OyAvL1xuICAgICAgICAgICAgICB2YXIgeSA9IGNoaWxkc1trXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgneScpWzBdLnRleHRDb250ZW50O1xuICAgICAgICAgICAgICBlU2hlZXBDaGlsZC5fc2V0UG9zaXRpb24odGhpcy5fcGFyc2VLZXlXb3Jkcyh4KSwgdGhpcy5fcGFyc2VLZXlXb3Jkcyh5KSwgdHJ1ZSk7XG4gICAgICAgICAgICAgIGVTaGVlcENoaWxkLlN0YXJ0KHRoaXMuYW5pbWF0aW9uRmlsZSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICByZXR1cm4gbm9kZUZvdW5kO1xuICAgIH1cblxuICAgIC8qXHJcbiAgICAgKiBDaGVjayBpZiBzaGVlcCBpcyB3YWxraW5nIG92ZXIgYSBkZWZpbmVkIEhUTUwgVEFHLWVsZW1lbnRcclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiX2NoZWNrT3ZlcmxhcHBpbmdcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gX2NoZWNrT3ZlcmxhcHBpbmcoKSB7XG4gICAgICB2YXIgeCA9IHRoaXMuaW1hZ2VYO1xuICAgICAgdmFyIHkgPSB0aGlzLmltYWdlWSArIHRoaXMuaW1hZ2VIO1xuICAgICAgdmFyIHJlY3Q7XG4gICAgICB2YXIgbWFyZ2luID0gMjA7XG4gICAgICBpZiAodGhpcy5IVE1MZWxlbWVudCkgbWFyZ2luID0gNTtcbiAgICAgIGZvciAodmFyIGluZGV4IGluIENPTExJU0lPTl9XSVRIKSB7XG4gICAgICAgIHZhciBlbHMgPSBkb2N1bWVudC5ib2R5LmdldEVsZW1lbnRzQnlUYWdOYW1lKENPTExJU0lPTl9XSVRIW2luZGV4XSk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICByZWN0ID0gZWxzW2ldLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICAgICAgaWYgKHkgPiByZWN0LnRvcCAtIDIgJiYgeSA8IHJlY3QudG9wICsgbWFyZ2luKSB7XG4gICAgICAgICAgICBpZiAoeCA+IHJlY3QubGVmdCAmJiB4IDwgcmVjdC5yaWdodCAtIHRoaXMuaW1hZ2VXKSB7XG4gICAgICAgICAgICAgIHZhciBzdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsc1tpXSk7XG4gICAgICAgICAgICAgIGlmIChzdHlsZS5ib3JkZXJUb3BTdHlsZSAhPSBcIlwiICYmIHN0eWxlLmJvcmRlclRvcFN0eWxlICE9IFwibm9uZVwiICYmIHN0eWxlLmRpc3BsYXkgIT0gXCJub25lXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxzW2ldO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLypcclxuICAgICAqIFRyeSB0byBnZXQgdGhlIHZhbHVlIG9mIGEgbm9kZSAoZnJvbSB0aGUgY3VycmVudCBhbmltYXRpb25Ob2RlKSwgaWYgaXQgaXMgbm90IHBvc3NpYmxlIHJldHVybnMgdGhlIGRlZmF1bHRWYWx1ZVxyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJfZ2V0Tm9kZVZhbHVlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXROb2RlVmFsdWUobm9kZU5hbWUsIHZhbHVlTmFtZSwgZGVmYXVsdFZhbHVlKSB7XG4gICAgICBpZiAoIXRoaXMuYW5pbWF0aW9uTm9kZSB8fCAhdGhpcy5hbmltYXRpb25Ob2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKG5vZGVOYW1lKSkgcmV0dXJuO1xuICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uTm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZShub2RlTmFtZSlbMF0uZ2V0RWxlbWVudHNCeVRhZ05hbWUodmFsdWVOYW1lKVswXSkge1xuICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUobm9kZU5hbWUpWzBdLmdldEVsZW1lbnRzQnlUYWdOYW1lKHZhbHVlTmFtZSlbMF0udGV4dENvbnRlbnQ7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnNlS2V5V29yZHModmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKlxyXG4gICAgICogTmV4dCBzdGVwIChlYWNoIGZyYW1lIGlzIGEgc3RlcClcclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiX25leHRFU2hlZXBTdGVwXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIF9uZXh0RVNoZWVwU3RlcCgpIHtcbiAgICAgIHZhciB4MSA9IHRoaXMuX2dldE5vZGVWYWx1ZSgnc3RhcnQnLCAneCcsIDApO1xuICAgICAgdmFyIHkxID0gdGhpcy5fZ2V0Tm9kZVZhbHVlKCdzdGFydCcsICd5JywgMCk7XG4gICAgICB2YXIgb2ZmMSA9IHRoaXMuX2dldE5vZGVWYWx1ZSgnc3RhcnQnLCAnb2Zmc2V0eScsIDApO1xuICAgICAgdmFyIG9wYTEgPSB0aGlzLl9nZXROb2RlVmFsdWUoJ3N0YXJ0JywgJ29wYWNpdHknLCAxKTtcbiAgICAgIHZhciBkZWwxID0gdGhpcy5fZ2V0Tm9kZVZhbHVlKCdzdGFydCcsICdpbnRlcnZhbCcsIDEwMDApO1xuICAgICAgdmFyIHgyID0gdGhpcy5fZ2V0Tm9kZVZhbHVlKCdlbmQnLCAneCcsIDApO1xuICAgICAgdmFyIHkyID0gdGhpcy5fZ2V0Tm9kZVZhbHVlKCdlbmQnLCAneScsIDApO1xuICAgICAgdmFyIG9mZjIgPSB0aGlzLl9nZXROb2RlVmFsdWUoJ2VuZCcsICdvZmZzZXR5JywgMCk7XG4gICAgICB2YXIgb3BhMiA9IHRoaXMuX2dldE5vZGVWYWx1ZSgnZW5kJywgJ2ludGVydmFsJywgMSk7XG4gICAgICB2YXIgZGVsMiA9IHRoaXMuX2dldE5vZGVWYWx1ZSgnZW5kJywgJ2ludGVydmFsJywgMTAwMCk7XG5cbiAgICAgIHZhciByZXBlYXQgPSB0aGlzLl9wYXJzZUtleVdvcmRzKHRoaXMuYW5pbWF0aW9uTm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2VxdWVuY2UnKVswXS5nZXRBdHRyaWJ1dGUoJ3JlcGVhdCcpKTtcbiAgICAgIHZhciByZXBlYXRmcm9tID0gdGhpcy5hbmltYXRpb25Ob2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzZXF1ZW5jZScpWzBdLmdldEF0dHJpYnV0ZSgncmVwZWF0ZnJvbScpO1xuICAgICAgdmFyIGdyYXZpdHkgPSB0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2dyYXZpdHknKTtcbiAgICAgIHZhciBib3JkZXIgPSB0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvcmRlcicpO1xuXG4gICAgICB2YXIgc3RlcHMgPSB0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ZyYW1lJykubGVuZ3RoICsgKHRoaXMuYW5pbWF0aW9uTm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZnJhbWUnKS5sZW5ndGggLSByZXBlYXRmcm9tKSAqIHJlcGVhdDtcblxuICAgICAgdmFyIGluZGV4O1xuXG4gICAgICBpZiAodGhpcy5hbmltYXRpb25TdGVwIDwgdGhpcy5hbmltYXRpb25Ob2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdmcmFtZScpLmxlbmd0aCkgaW5kZXggPSB0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ZyYW1lJylbdGhpcy5hbmltYXRpb25TdGVwXS50ZXh0Q29udGVudDtlbHNlIGlmIChyZXBlYXRmcm9tID09IDApIGluZGV4ID0gdGhpcy5hbmltYXRpb25Ob2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdmcmFtZScpW3RoaXMuYW5pbWF0aW9uU3RlcCAlIHRoaXMuYW5pbWF0aW9uTm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZnJhbWUnKS5sZW5ndGhdLnRleHRDb250ZW50O2Vsc2UgaW5kZXggPSB0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ZyYW1lJylbcGFyc2VJbnQocmVwZWF0ZnJvbSkgKyBwYXJzZUludCgodGhpcy5hbmltYXRpb25TdGVwIC0gcmVwZWF0ZnJvbSkgJSAodGhpcy5hbmltYXRpb25Ob2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdmcmFtZScpLmxlbmd0aCAtIHJlcGVhdGZyb20pKV0udGV4dENvbnRlbnQ7XG5cbiAgICAgIHRoaXMuRE9NaW1nLnN0eWxlLmxlZnQgPSAtdGhpcy5pbWFnZVcgKiAoaW5kZXggJSB0aGlzLnRpbGVzWCkgKyBcInB4XCI7XG4gICAgICB0aGlzLkRPTWltZy5zdHlsZS50b3AgPSAtdGhpcy5pbWFnZUggKiBwYXJzZUludChpbmRleCAvIHRoaXMudGlsZXNYKSArIFwicHhcIjtcblxuICAgICAgaWYgKHRoaXMuZHJhZ2dpbmcgfHwgdGhpcy5pbmZvYm94KSB7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uU3RlcCsrO1xuICAgICAgICBzZXRUaW1lb3V0KHRoaXMuX25leHRFU2hlZXBTdGVwLmJpbmQodGhpcyksIDUwKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5mbGlwcGVkKSB7XG4gICAgICAgIHgxID0gLXgxO1xuICAgICAgICB4MiA9IC14MjtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uU3RlcCA9PSAwKSB0aGlzLl9zZXRQb3NpdGlvbih4MSwgeTEsIGZhbHNlKTtlbHNlIHRoaXMuX3NldFBvc2l0aW9uKHBhcnNlSW50KHgxKSArIHBhcnNlSW50KCh4MiAtIHgxKSAqIHRoaXMuYW5pbWF0aW9uU3RlcCAvIHN0ZXBzKSwgcGFyc2VJbnQoeTEpICsgcGFyc2VJbnQoKHkyIC0geTEpICogdGhpcy5hbmltYXRpb25TdGVwIC8gc3RlcHMpLCBmYWxzZSk7XG5cbiAgICAgIHRoaXMuYW5pbWF0aW9uU3RlcCsrO1xuXG4gICAgICBpZiAodGhpcy5hbmltYXRpb25TdGVwID49IHN0ZXBzKSB7XG4gICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2FjdGlvbicpWzBdKSB7XG4gICAgICAgICAgc3dpdGNoICh0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2FjdGlvbicpWzBdLnRleHRDb250ZW50KSB7XG4gICAgICAgICAgICBjYXNlIFwiZmxpcFwiOlxuICAgICAgICAgICAgICBpZiAodGhpcy5ET01kaXYuc3R5bGUudHJhbnNmb3JtID09IFwicm90YXRlWSgwZGVnKVwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ET01kaXYuc3R5bGUudHJhbnNmb3JtID0gXCJyb3RhdGVZKDE4MGRlZylcIjtcbiAgICAgICAgICAgICAgICB0aGlzLmZsaXBwZWQgPSB0cnVlO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuRE9NZGl2LnN0eWxlLnRyYW5zZm9ybSA9IFwicm90YXRlWSgwZGVnKVwiO1xuICAgICAgICAgICAgICAgIHRoaXMuZmxpcHBlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcblxuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl9nZXROZXh0UmFuZG9tTm9kZSh0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NlcXVlbmNlJylbMF0pKSByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBzZXROZXh0ID0gZmFsc2U7XG5cbiAgICAgIGlmIChib3JkZXIgJiYgYm9yZGVyWzBdICYmIGJvcmRlclswXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnbmV4dCcpKSB7XG4gICAgICAgIGlmICh4MiA8IDAgJiYgdGhpcy5pbWFnZVggPCAwKSB7XG4gICAgICAgICAgdGhpcy5pbWFnZVggPSAwO1xuICAgICAgICAgIHNldE5leHQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHgyID4gMCAmJiB0aGlzLmltYWdlWCA+IHRoaXMuc2NyZWVuVyAtIHRoaXMuaW1hZ2VXKSB7XG4gICAgICAgICAgdGhpcy5pbWFnZVggPSB0aGlzLnNjcmVlblcgLSB0aGlzLmltYWdlVztcbiAgICAgICAgICB0aGlzLkRPTWRpdi5zdHlsZS5sZWZ0ID0gcGFyc2VJbnQodGhpcy5pbWFnZVgpICsgXCJweFwiO1xuICAgICAgICAgIHNldE5leHQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHkyIDwgMCAmJiB0aGlzLmltYWdlWSA8IDApIHtcbiAgICAgICAgICB0aGlzLmltYWdlWSA9IDA7XG4gICAgICAgICAgc2V0TmV4dCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoeTIgPiAwICYmIHRoaXMuaW1hZ2VZID4gdGhpcy5zY3JlZW5IIC0gdGhpcy5pbWFnZUgpIHtcbiAgICAgICAgICB0aGlzLmltYWdlWSA9IHRoaXMuc2NyZWVuSCAtIHRoaXMuaW1hZ2VIO1xuICAgICAgICAgIHNldE5leHQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHkyID4gMCkge1xuICAgICAgICAgIGlmICh0aGlzLl9jaGVja092ZXJsYXBwaW5nKCkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmltYWdlWSA+IHRoaXMuaW1hZ2VIKSB7XG4gICAgICAgICAgICAgIHRoaXMuSFRNTGVsZW1lbnQgPSB0aGlzLl9jaGVja092ZXJsYXBwaW5nKCk7XG4gICAgICAgICAgICAgIHRoaXMuaW1hZ2VZID0gTWF0aC5jZWlsKHRoaXMuSFRNTGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wKSAtIHRoaXMuaW1hZ2VIO1xuICAgICAgICAgICAgICBzZXROZXh0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5IVE1MZWxlbWVudCkge1xuICAgICAgICAgIGlmICghdGhpcy5fY2hlY2tPdmVybGFwcGluZygpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pbWFnZVkgKyB0aGlzLmltYWdlSCA+IHRoaXMuSFRNTGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wICsgMyB8fCB0aGlzLmltYWdlWSArIHRoaXMuaW1hZ2VIIDwgdGhpcy5IVE1MZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgLSAzKSB7XG4gICAgICAgICAgICAgIHRoaXMuSFRNTGVsZW1lbnQgPSBudWxsO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmltYWdlWCA8IHRoaXMuSFRNTGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCkge1xuICAgICAgICAgICAgICB0aGlzLmltYWdlWCA9IHBhcnNlSW50KHRoaXMuaW1hZ2VYICsgMyk7XG4gICAgICAgICAgICAgIHNldE5leHQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5pbWFnZVggPSBwYXJzZUludCh0aGlzLmltYWdlWCAtIDMpO1xuICAgICAgICAgICAgICBzZXROZXh0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuRE9NZGl2LnN0eWxlLmxlZnQgPSBwYXJzZUludCh0aGlzLmltYWdlWCkgKyBcInB4XCI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChzZXROZXh0KSB7XG4gICAgICAgICAgaWYgKCF0aGlzLl9nZXROZXh0UmFuZG9tTm9kZShib3JkZXJbMF0pKSByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghc2V0TmV4dCAmJiBncmF2aXR5ICYmIGdyYXZpdHlbMF0gJiYgZ3Jhdml0eVswXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnbmV4dCcpKSB7XG4gICAgICAgIGlmICh0aGlzLmltYWdlWSA8IHRoaXMuc2NyZWVuSCAtIHRoaXMuaW1hZ2VIIC0gMikge1xuICAgICAgICAgIGlmICh0aGlzLkhUTUxlbGVtZW50ID09IG51bGwpIHtcbiAgICAgICAgICAgIHNldE5leHQgPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2NoZWNrT3ZlcmxhcHBpbmcoKSkge1xuICAgICAgICAgICAgICBzZXROZXh0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgdGhpcy5IVE1MZWxlbWVudCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHNldE5leHQpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5fZ2V0TmV4dFJhbmRvbU5vZGUoZ3Jhdml0eVswXSkpIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghc2V0TmV4dCkge1xuICAgICAgICBpZiAodGhpcy5pbWFnZVggPCAtdGhpcy5pbWFnZVcgJiYgeDIgPCAwIHx8IHRoaXMuaW1hZ2VYID4gdGhpcy5zY3JlZW5XICYmIHgyID4gMCB8fCB0aGlzLmltYWdlWSA8IC10aGlzLmltYWdlSCAmJiB5MSA8IDAgfHwgdGhpcy5pbWFnZVkgPiB0aGlzLnNjcmVlbkggJiYgeTIgPiAwKSB7XG4gICAgICAgICAgc2V0TmV4dCA9IHRydWU7XG4gICAgICAgICAgaWYgKCF0aGlzLmlzQ2hpbGQpIHtcbiAgICAgICAgICAgIHRoaXMuX3NwYXduRVNoZWVwKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBzZXRUaW1lb3V0KHRoaXMuX25leHRFU2hlZXBTdGVwLmJpbmQodGhpcyksIHBhcnNlSW50KGRlbDEpICsgcGFyc2VJbnQoKGRlbDIgLSBkZWwxKSAqIHRoaXMuYW5pbWF0aW9uU3RlcCAvIHN0ZXBzKSk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIGVTaGVlcDtcbn0oKTtcblxuOyJdfQ==
